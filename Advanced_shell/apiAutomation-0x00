#!/bin/bash

# Script: apiAutomation-0x00
# Description: Fetch Pikachu data from PokÃ©mon API and save to data.json
# Error handling included

# API URL for Pikachu
URL="https://pokeapi.co/api/v2/pokemon/pikachu"

# Make the API request and save response to data.json
# Redirect stderr (errors) to errors.txt
curl -s "$URL" -o data.json 2>> errors.txt

# Check if curl was successful
if [ $? -ne 0 ]; then
    echo "Failed to fetch data from API at $(date)" >> errors.txt
    exit 1
fi

# Check if we got a valid JSON response
if [ -s "data.json" ]; then
    # Test if the file contains valid JSON
    if jq . data.json >/dev/null 2>&1; then
        echo "Data successfully saved to data.json"
    else
        echo "Invalid JSON received from API" >> errors.txt
        echo "Response content:" >> errors.txt
        cat data.json >> errors.txt
    fi
else
    echo "Empty response received from API" >> errors.txt
fi
